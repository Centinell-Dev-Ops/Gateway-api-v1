

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Solicitud de Acceso</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <!-- Script oficial de la API de Telegram para Web Apps -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* [Todo el CSS previo que ten칤as para el estilo del bot칩n y la p치gina] */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            background-color: #111;
            width: 100vw;
            height: 100vh;
            min-height: -webkit-fill-available;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        .container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .telegram-btn {
            width: 100%;
            min-width: 300px;
            height: 25vh;
            min-height: 120px;
            max-height: 200px;
            font-size: min(10vw, 48px);
            font-weight: 900;
            letter-spacing: 1.5px;
            background: linear-gradient(145deg, #007bff, #0056cc); /* Azul */
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 
                0 10px 30px rgba(0, 123, 255, 0.4),
                0 4px 15px rgba(0, 0, 0, 0.3),
                inset 0 2px 0 rgba(255, 255, 255, 0.2);
            padding: 25px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            touch-action: manipulation;
        }
        .telegram-btn:active {
            transform: scale(0.98);
            box-shadow: 
                0 5px 20px rgba(0, 123, 255, 0.3),
                0 2px 10px rgba(0, 0, 0, 0.2);
            background: linear-gradient(145deg, #0056cc, #00409c);
        }
        @media (max-width: 480px) {
            .telegram-btn {
                height: 140px;
                min-height: 140px;
                font-size: 36px;
                border-radius: 20px;
            }
        }
        @media (min-width: 768px) {
            .telegram-btn {
                width: 80%;
                max-width: 600px;
                height: 150px;
                font-size: min(5vw, 60px);
                border-radius: 35px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Bot칩n con texto aclaratorio y emoji -->
        <button class="telegram-btn" id="mainButton">
            游닐 Abrir Telegram para enviar solicitud
        </button>
    </div>

    <script>
        // 1. Referencias a elementos y configuraci칩n
        const mainButton = document.getElementById('mainButton');
        const telegramLink = 'https://t.me/+hUWgO1P26_M0MGI5'; // Tu enlace de invitaci칩n al canal

        // 2. L칩gica principal: Detectar si el usuario REGRESA de la pantalla de Telegram
        // Esta funci칩n verifica si el usuario acaba de volver de abrir el enlace externo.
        function checkIfReturnedFromRedirect() {
            // Intenta detectar si la p치gina se carg칩 al volver de otra ventana/pesta침a.
            // Una se침al com칰n es que el 'referrer' (p치gina anterior) sea nulo o la misma p치gina,
            // lo que ocurre a menudo en WebViews como la de Telegram al regresar.
            // Si el rendimiento es del propio dominio o est치 vac칤o, asumimos un regreso.
            const referrer = document.referrer;
            const cameFromSameOrigin = referrer === '' || referrer.includes(window.location.origin);

            // Otra se침al: Si la p치gina se carga de manera muy r치pida y tiene el foco,
            // podr칤a ser porque el usuario volvi칩 y la WebView la recarg칩.
            // Esta no es una ciencia exacta, pero funciona bien en la pr치ctica para este caso.
            if (cameFromSameOrigin && document.visibilityState === 'visible') {
                console.log('Posible regreso detectado. Cerrando la Mini App...');
                // 3. Cerrar la Mini App usando la API de Telegram
                // Esta es la l칤nea clave que cierra la ventana de la aplicaci칩n dentro de Telegram.
                if (window.Telegram && Telegram.WebApp) {
                    Telegram.WebApp.close();
                } else {
                    // Fallback si por alguna raz칩n no carga la API: al menos redirige fuera.
                    console.warn('API de Telegram no encontrada. Redirigiendo a inicio.');
                    window.location.href = 'https://t.me'; // Redirige al cliente principal de Telegram
                }
            }
        }

        // 4. Configurar el comportamiento del bot칩n principal
        mainButton.addEventListener('click', function() {
            console.log('Bot칩n presionado. Abriendo enlace de Telegram...');
            // Abre el enlace del canal en la misma ventana/pesta침a.
            // Esto es crucial: al abrirse en la misma pesta침a, Telegram mostrar치 su pantalla nativa
            // (la segunda pantalla con la descripci칩n del canal y "Solicitar unirse").
            window.location.href = telegramLink;
        });

        // 5. Inicializaci칩n: Ejecutar la detecci칩n al cargar la p치gina y al recibir el foco
        // Verificamos al cargar si el usuario ya est치 regresando.
        window.addEventListener('load', checkIfReturnedFromRedirect);
        // Tambi칠n verificamos cuando la p치gina vuelve a ser visible (el usuario regresa y cambia el foco).
        document.addEventListener('visibilitychange', checkIfReturnedFromRedirect);
    </script>
</body>
</html>
